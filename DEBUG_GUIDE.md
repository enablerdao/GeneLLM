# GeneLLM デバッグガイド

## 基本的なデバッグ方法

GeneLLMシステムには以下のデバッグ方法が用意されています：

### 1. デバッグモードでの実行

```bash
# デバッグモードで実行（詳細な内部処理を表示）
./gllm -d "質問文をここに入力"

# 環境変数を使ったデバッグモード
DEBUG=1 ./gllm "質問文をここに入力"
```

デバッグモードでは以下の情報が表示されます：
- 各エージェントのスコアとしきい値
- 選択されたエージェント
- 各トピックのスコア
- 選択されたトピック
- 推論ルールの適用過程
- マッチングの詳細情報

### 2. ステータス確認

```bash
# システムの現在の状態を確認
./gllm status
```

表示される情報：
- 登録トピック数と各トピックの知識数
- 総知識数
- 推論ルール数
- 辞書登録単語数
- ベクトル次元数

### 3. ログファイルの確認

システムは `data/logs/` ディレクトリに詳細なログを出力します。ログファイルの命名規則は以下の通りです：

```
YYYY-MM-DD_HH-MM-SS_Q_[timestamp].log
```

ログファイルには以下の情報が含まれます：
- 質問内容
- 生成された回答
- 処理時間
- 使用されたエージェントとトピック
- 単語数と文字数
- その他のデバッグ情報

## 高度なデバッグ

### コンパイラ検証機能のデバッグ

C言語のコード生成機能をデバッグするには、専用のテストツールを使用します：

```bash
# C言語ルーターのテスト実行
./bin/c_router_test
```

### ベクトル検索のデバッグ

ベクトル検索機能のデバッグには以下のコマンドを使用します：

```bash
# 基本的なベクトル検索のテスト
./bin/main vector

# 改良版ベクトル検索のテスト
./bin/main vector_improved
```

### メモリ使用量の確認

```bash
# メモリ使用量を確認しながら実行
valgrind --tool=memcheck ./gllm "質問文"
```

## トラブルシューティング

### 一般的な問題と解決策

1. **応答が常に同じトピックの内容になる**
   - トピック選択アルゴリズムの閾値を確認
   - 入力テキストの形態素解析結果を確認

2. **特定のパターンが認識されない**
   - パターンマッチングのロジックを確認
   - 正規表現やキーワードの設定を見直す

3. **コンパイルエラー**
   - 必要なヘッダファイルが含まれているか確認
   - 依存ライブラリがインストールされているか確認

4. **セグメンテーションフォルト**
   - メモリ管理の問題を確認
   - ポインタの使用方法を見直す

## ソースコードの主要部分

デバッグ時に確認すべき主要なソースコードファイル：

- `src/main.c`: メインプログラム
- `src/improved_router_model.c`: 改良型ルーターモデル
- `src/include/c_programming_router.c`: C言語プログラミングルーター
- `src/include/compiler_validator.c`: コンパイラ検証機能
- `src/vector_search/vector_search.c`: ベクトル検索機能
- `src/include/vector_db.c`: ベクトルデータベース

## 開発環境の設定

デバッグに適した開発環境の設定：

```bash
# デバッグシンボル付きでコンパイル
gcc -g -Wall -Wextra -std=c99 -o bin/gllm src/main.c [その他の依存ファイル] -lmecab -lm -lcurl

# GDBでデバッグ実行
gdb ./bin/gllm
```

## ログレベルの設定

環境変数でログレベルを設定できます：

- `DEBUG=1`: 基本的なデバッグ情報
- `DEBUG=2`: 詳細なデバッグ情報
- `DEBUG=3`: 最も詳細なデバッグ情報（開発者向け）

例：
```bash
DEBUG=3 ./gllm "質問文"
```